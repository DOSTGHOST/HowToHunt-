# 参考

- [原文](https://github.com/KathanP19/HowToHunt/blob/master/Broken_Auth_And_Session_Management/Session_based_bugs.md)

# 身份验证和会话管理失效

## 密码更改后旧会话不会过期

测试步骤

```
1. 在目标网站上创建账户
2. 使用同一账户登录两个浏览器（Chrome、FireFox，也可以使用隐身模式）
3. 在 Chrome 中更改密码，成功更改密码后，请在 FireFox/隐身模式下刷新您已登录的账户。
4. 如果您仍处于登录状态，则这是一个 Bug
```



## 会话劫持（预期行为）

测试步骤 

```
1. 创建您的账户
2. 登录您的账户
3. 使用浏览器中的 Cookie 编辑器扩展程序
4. 复制所有目标 Cookie
5. 注销您的账户
6. 将这些 Cookie 粘贴到 Cookie 编辑器扩展程序中
7. 如果您已登录，请刷新页面，否则此行为构成会话劫持
```

影响：如果攻击者获取受害者的 cookie，将导致帐户被接管。



## 密码重置令牌不会过期（不安全的可配置性）

测试步骤

```
1. 在目标网站上创建您的账户。
2. 请求一个忘记密码令牌。
3. 不要使用该链接。
4. 请使用旧密码登录，并将您的邮箱更改为其他邮箱。
5. 现在使用发送到旧邮箱的密码链接，检查您是否可以更改密码。如果可以，则说明存在一个小错误。
```



## 服务器安全配置错误 -> 缺少安全标头 -> 安全页面的缓存控制

测试步骤

```
1. 登录应用程序
2. 浏览页面
3. 注销
4. 按 Alt+左箭头键
5. 如果您已登录或可以查看用户浏览过的页面，则说明您发现了一个错误。
```

影响：在网吧，如果一个人在一个非常重要且包含大量详细信息的页面上退出，然后另一个人再次点击返回（因为他没有关闭浏览器），那么数据就会被泄露。用户信息泄露



##  绕过电子邮件验证的身份验证漏洞（P4）

类别：P4 >> 身份验证和会话管理失败 >> 会话无效 >> 密码重置和/或更改

测试步骤

```
1)首先，您需要创建一个帐户，然后您会收到一个电子邮件验证链接。
2)就我的情况而言，如果未经验证，应用程序会授予较少的权限和功能。
3)登录应用程序后，我将电子邮件地址更改为电子邮件B。
4)已发送验证链接，我已验证。
5)现在，我再次将电子邮件改回我在创建帐户时输入的电子邮件。
6)它显示我的电子邮件已经过验证。
7)因此，由于我尚未验证在创建帐户时发送给我的链接，因此成功的电子邮件验证被绕过，但我的电子邮件仍然已得到验证。
8)当我改回电子邮件后，没有再次收到任何验证码，当我打开帐户时，它在我的个人资料中显示其电子邮件已验证。
```



## 电子邮件验证绕过（P3/P4）

测试步骤

```
1) 首先，您需要使用自己的电子邮件地址创建一个帐户。
2) 创建帐户后，验证链接将发送到您的帐户。
3) 请勿使用电子邮件验证链接。请将您的电子邮件更改为受害者的电子邮件地址。
4) 现在，进入您的电子邮件并点击您自己的电子邮件验证链接。
5) 如果受害者的电子邮件地址通过验证，则这是一个 Bug。
```





## 请求新密码重置令牌时旧密码重置令牌不会过期（有时为 P4）

测试步骤

```
1) 首先，您需要创建一个具有有效电子邮件地址的帐户。
2) 创建帐户后，请退出您的帐户并导航至“忘记密码”页面。
3) 请求一个用于您帐户的密码重置链接。验证链接将发送到您的帐户。
4) 如果未使用此密码重置链接，请请求一个新的密码重置链接。
5) 现在，请登录您的电子邮件，使用第一个密码重置链接（而不是第二个链接）并更改您的密码。
6) 如果您可以更改密码，那么这只是一个小错误 ;)。
```



## 账户流程验证不足导致账户被接管（P3/P4）

测试步骤

```
1) 在网站上创建一个帐户。
2) 前往个人资料部分。在名称参数中更改并更新您的详细信息，并在保存之前打开 Burp Suite，启用代理，然后点击“保存”。
3) 现在在 Burp Suite 中捕获请求并将其发送到“repeater”选项卡。
4) 现在退出网站并返回 Burp Suite。
5) 现在更改电子邮件和名称参数的详细信息，然后点击“repeater”选项卡中的“开始”。
6) 现在您将能够看到来自 Web 服务器的 200 ok 响应。
7) 现在登录您的帐户并前往“个人资料”部分进行确认。
```



